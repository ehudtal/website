<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="A New Internet">
  <link rel="icon" href="../../favicon.ico">

  <title>NYC Mesh - A New Internet</title>

  <!-- Bootstrap core CSS -->
  <link href="css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="css/style.css" rel="stylesheet">

  <!-- MapBox -->
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.js'></script>
  <script src='https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-heat/v0.1.0/leaflet-heat.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.4/mapbox.css' rel='stylesheet' />

</head>

<body>

  <div class="site-wrapper">

    <div class="site-wrapper-inner">
      <div id='map'></div>

      <div class="cover-container">

        <div class="masthead clearfix">
          <div class="inner">

            <a href="#" id="logo"><img src="logo.png" class="masthead-brand" id="logo_img"><h3 class="masthead-brand">NYC Mesh</h3></a>
            <nav>
              <ul class="nav masthead-nav">
                <!-- <li ><a href="#">Blog</a></li> -->
                <li class="btn-default" id="submit"><a href="join.html">Submit</a></li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- <div class="location_question">
        <p class="lead">What is your location?</p>
      </div> -->

      <div class="inner cover">
        <h1 class="cover-heading" id="location">Where are you located?</h1>

        <div id="main_text">
          <h1 class="cover-heading">A New, Free Network.</h1>
          <p class="lead">Owned and operated by our community.</p>
          <p class="lead">
            <a href="#" class="btn btn-lg btn-default" onclick="addNode()">Get Connected</a>
          </p>
        </div> <!-- end main text -->
      </div>
    </div>
  </div>
</div>

<div class="cover-container">
  <div class="inner cover">

    <div id="what">
      <h1 class="cover-heading">What is a Mesh?</h1>
      <p class="lead">Our network is built using WiFi routers spread across the city. These routers are the "nodes" of our mesh network. A mesh network has no central server and no single internet service provider.
      </p>
    </div>
  </div>

</div>

<div class="container do">
  <div class="inner cover">

    <div id="what">
      <h1 class="cover-heading">Our Mission</h1>
      <p class="lead">We are building a resilient system that will work for daily use and also can be accessed during emergencies, power outages and internet disruptions. We will be running software for the community that is useful both for everyday needs and emergencies.
      </p>
    </div>
  </div>

</div>

<div class="container do">
  <div class="inner cover">

    <div id="what">
      <h1 class="cover-heading">Get Involved</h1>
      <p class="lead">To join the mesh you can create a new node by simply buying a small router for less than $100 and no monthly fees. We will help you configure and install the device.
      </br></br> We meet every Sunday in downtown Manhattan. Occasionally we meet with other related organizations. Please join our <a href="http://www.meetup.com/nycmesh/">meetup group</a> for more information. We welcome people from all backgrounds.
    </p>
  </div>
</div>

</div>

<p class="lead_bottom">
  <a href="#" class="btn btn-lg btn-default" onclick="addNode()">Join the Mesh</a>
</p>


<script>
L.mapbox.accessToken = 'pk.eyJ1Ijoib28iLCJhIjoiWXFoMHRIWSJ9.ZdI5DZEZ0qE6J0IcsR3w1w';
var map = L.mapbox.map('map', 'oo.k9efp640', {
  zoomControl: false,
  showMarkers: false
}),
heat = L.heatLayer([], { maxZoom: 15.5 }).addTo(map);

// Add each marker point to the heatmap.
var layer = L.mapbox.featureLayer('oo.k9efp640').on('ready', function() {
  layer.eachLayer(function(l) {
    heat.addLatLng(l.getLatLng());
  });
});

// hide all markers
map.featureLayer
.setFilter(function() { return false; })
.addTo(map);

map.scrollWheelZoom.disable();
map.doubleClickZoom.disable();
map.touchZoom.disable();
map.dragging.disable();

function addNode() {
  map.scrollWheelZoom.enable();
  map.doubleClickZoom.enable();
  map.touchZoom.enable();
  map.dragging.enable();
  new L.Control.Zoom().addTo(map);


  // document.getElementById("map").style.zIndex = 0;
  document.getElementById("main_text").style.display = "none";
  document.getElementById("location").style.display = "inherit";
  document.getElementById("logo").href = "index.html";
  setTimeout(function(){
    document.getElementById("map").style.zIndex = 0;
    document.getElementById("location").style.display = "none";
  }, 4000);
  map.addLayer(L.mapbox.tileLayer('oo.kbip7077'));
}

var addedMarker = false;
var marker;

map.on('click', function(click) {

  var locationQuestion = document.getElementById("location");
  var submitButton = document.getElementById("submit");
  locationQuestion.style.display = "none";
  submit.style.display = "inherit";
  locationQuestion

  if (!addedMarker) {
    addedMarker = true;
    marker = L.marker(click.latlng, {
      draggable: true
    });
    marker.addTo(map);
  }
  else {
    marker._latlng = click.latlng;
    marker.update();
  }
});

</script>
